<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumi Suporte - Sistema de Chamados</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0d1117; --bg-secondary: #161b22; --glass-bg: rgba(22, 27, 34, 0.6);
            --text-primary: #e2e8f0; --text-secondary: #9ca3af; --text-title: #00d4ff; /* Alterado para azul elétrico */
            --border-color: rgba(255, 255, 255, 0.1); --input-bg: #1e293b; --input-border: #334155;
            --btn-bg: #1e293b; --btn-border: #334155; --btn-hover-bg: #334155;
            --accent-orange: #ff6b35; --electric-blue: #00d4ff; --dark-overlay: rgba(10, 25, 47, 0.9);
        }
        .light-theme {
            --bg-primary: #f1f5f9; --bg-secondary: #ffffff; --glass-bg: rgba(255, 255, 255, 0.7);
            --text-primary: #0f172a; --text-secondary: #475569; --text-title: #0c7a91;
            --border-color: #e2e8f0; --input-bg: #ffffff; --input-border: #cbd5e1;
            --btn-bg: #f1f5f9; --btn-border: #cbd5e1; --btn-hover-bg: #e2e8f0;
        }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg-primary); color: var(--text-primary); transition: background-color 0.3s, color 0.3s; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .logo-symbol { width: 50px; height: 50px; background: linear-gradient(135deg, var(--dark-overlay), var(--dark-overlay)); border-radius: 10px; margin-right: 15px; display: flex; align-items: center; justify-content: center; position: relative; animation: glow 2s ease-in-out infinite alternate; }
        @keyframes glow { from { box-shadow: 0 0 20px var(--accent-orange); } to { box-shadow: 0 0 30px var(--electric-blue), 0 0 40px var(--electric-blue); } }
        .glass-effect { background: var(--glass-bg); backdrop-filter: blur(10px); border: 1px solid var(--border-color); transition: background-color 0.3s, border-color 0.3s; }
        .glow-text { text-shadow: 0 0 5px rgba(0, 212, 255, 0.5), 0 0 10px rgba(0, 212, 255, 0.5); }
        .light-theme .glow-text { text-shadow: none; }
        .action-btn { background: transparent; border: none; cursor: pointer; padding: 4px; border-radius: 50%; transition: background-color 0.2s; color: var(--text-secondary); }
        .action-btn:hover { background-color: rgba(127, 127, 127, 0.1); }
        ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-track { background: var(--bg-primary); } ::-webkit-scrollbar-thumb { background: #2d3748; border-radius: 4px; } .light-theme ::-webkit-scrollbar-thumb { background: #cbd5e1; }
        .custom-input, .custom-select, .custom-textarea { background-color: var(--input-bg); border: 1px solid var(--input-border); color: var(--text-primary); border-radius: 0.375rem; padding: 0.5rem 0.75rem; width: 100%; }
        .light-theme .custom-input, .light-theme .custom-select, .light-theme .custom-textarea { color: var(--text-primary); }
        .custom-input::placeholder, .custom-textarea::placeholder { color: var(--text-secondary); }
        .page-btn { color: var(--text-secondary); background-color: transparent; padding: 0.5rem 1rem; border-radius: 0.375rem; transition: all 0.2s; font-weight: 500; }
        .page-btn:hover { background-color: var(--btn-hover-bg); }
        .page-btn-active { background-color: var(--text-title); color: white; box-shadow: 0 2px 10px -2px var(--text-title); }
        .status-badge { padding: 3px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; display: inline-flex; align-items: center; gap: 4px; text-align: center; }
        .status-resolvido { background-color: #166534; color: #dcfce7; }
        .status-andamento { background-color: #854d0e; color: #fef9c3; }
        .status-pendente { background-color: #991b1b; color: #fee2e2; }
        .light-theme .status-resolvido { background-color: #dcfce7; color: #166534; }
        .light-theme .status-andamento { background-color: #fef9c3; color: #854d0e; }
        .light-theme .status-pendente { background-color: #fee2e2; color: #991b1b; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; }
        .modal-label { color: var(--text-secondary); }
        .light-theme .modal-label { color: var(--text-primary); }
    </style>
</head>
<body class="min-h-screen">
    <!-- PÁGINA DE LOGIN -->
    <div id="loginPage" class="flex items-center justify-center min-h-screen">
        <div class="glass-effect p-8 rounded-lg shadow-2xl w-full max-w-sm">
            <div class="flex items-center justify-center gap-4 mb-8">
                <div class="logo-symbol">
                     <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="text-white" viewBox="0 0 16 16"><path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2M8 1.918l-.797.161A4 4 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4 4 0 0 0-3.203-3.92zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 .99 1.79A2.5 2.5 0 0 1 10 6c0 .88.32 4.2 1.22 6Z"/></svg>
                </div>
                <h1 class="text-3xl font-bold font-orbitron glow-text">Lumi Suporte</h1>
            </div>
            <form id="loginForm" class="space-y-6">
                <div>
                    <label for="username" class="modal-label block text-sm font-medium">Usuário</label>
                    <input type="text" id="username" class="custom-input mt-1" placeholder="admin" value="admin">
                </div>
                <div>
                    <label for="password" class="modal-label block text-sm font-medium">Senha</label>
                    <input type="password" id="password" class="custom-input mt-1" placeholder="••••••••" value="lumi10">
                </div>
                <button type="submit" class="w-full justify-center py-2 px-4 border-transparent rounded-md text-white bg-blue-600 hover:bg-blue-700">Entrar</button>
            </form>
        </div>
    </div>

    <!-- APLICAÇÃO PRINCIPAL -->
    <div id="app-wrapper" class="hidden container mx-auto px-4 sm:px-6 lg:px-8 max-w-full">
        <header class="flex items-center justify-between gap-4 mb-6 pt-4 sm:pt-6">
            <div class="flex items-center gap-4">
                <div class="logo-symbol">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="text-white" viewBox="0 0 16 16"><path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2M8 1.918l-.797.161A4 4 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4 4 0 0 0-3.203-3.92zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 .99 1.79A2.5 2.5 0 0 1 10 6c0 .88.32 4.2 1.22 6Z"/></svg>
                </div>
                <h1 class="text-3xl sm:text-4xl font-bold font-orbitron glow-text">Lumi Suporte</h1>
            </div>
            <div class="flex items-center gap-4">
                <button id="themeToggleBtn" class="action-btn p-2 rounded-full" title="Alternar tema"><svg id="theme-icon-sun" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg><svg id="theme-icon-moon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg></button>
                <button id="logoutBtn" class="action-btn p-2 rounded-full" title="Sair"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/><path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/></svg></button>
            </div>
        </header>

        <nav class="mb-8 p-2 glass-effect rounded-lg flex items-center justify-center sm:justify-start">
            <button id="pageChamadosBtn" class="page-btn page-btn-active">Chamados</button>
        </nav>

        <main id="app-content">
            <!-- PÁGINA CHAMADOS -->
            <div id="chamadosPage">
                <div class="glass-effect p-4 sm:p-6 rounded-lg">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-5 gap-4 flex-wrap">
                        <div class="flex flex-col sm:flex-row sm:flex-wrap items-center gap-2 w-full flex-grow">
                            <input type="search" id="searchChamadoInput" placeholder="Pesquisar por cliente..." class="custom-input sm:w-auto flex-grow">
                            <select id="filterTipo" class="custom-select sm:w-auto flex-grow-0"><option value="todos">Todos os Tipos</option><option>Vendas</option><option>Suporte Técnico</option><option>Financeiro</option><option>Outros</option></select>
                            <select id="filterStatus" class="custom-select sm:w-auto flex-grow-0"><option value="todos">Todos Status</option><option>Pendente</option><option>Em Andamento</option><option>Resolvido</option></select>
                        </div>
                        <div class="flex flex-col sm:flex-row items-center gap-2 w-full sm:w-auto">
                            <button id="addChamadoBtn" class="w-full sm:w-auto flex-shrink-0 bg-blue-600 text-white px-4 py-2 rounded-md font-semibold hover:bg-blue-700 transition">Novo Chamado</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="border-b" style="border-color: var(--border-color);">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Cód. Chamado</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Cliente</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Tipo</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Data Abertura</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium uppercase tracking-wider">Status</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="chamadosList"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- MODAIS -->
    <div id="addEditModal" class="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center hidden z-50 p-4">
        <div class="glass-effect p-8 rounded-lg shadow-2xl w-full max-w-lg">
            <h2 id="modalTitle" class="text-2xl font-semibold mb-5 font-orbitron" style="color: var(--text-title);"></h2>
            <form id="addEditForm" class="space-y-4">
                <input type="hidden" id="edit-id">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div><label class="modal-label block text-sm font-medium">Código do Cliente</label><input type="text" id="edit-codigoCliente" class="custom-input mt-1"></div>
                    <div><label class="modal-label block text-sm font-medium">Nome do Cliente</label><input type="text" id="edit-nomeCliente" required class="custom-input mt-1"></div>
                </div>
                 <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div><label class="modal-label block text-sm font-medium">Telefone</label><input type="tel" id="edit-telefone" class="custom-input mt-1"></div>
                    <div><label class="modal-label block text-sm font-medium">E-mail</label><input type="email" id="edit-email" class="custom-input mt-1"></div>
                </div>
                <div>
                    <label class="modal-label block text-sm font-medium">Tipo de Chamado</label>
                    <select id="edit-tipo" required class="custom-select mt-1">
                        <option>Vendas</option>
                        <option>Suporte Técnico</option>
                        <option>Financeiro</option>
                        <option>Outros</option>
                    </select>
                </div>
                <div>
                    <label class="modal-label block text-sm font-medium">Descrição</label>
                    <textarea id="edit-descricao" required class="custom-textarea mt-1" rows="4"></textarea>
                </div>
                <div class="flex gap-4 pt-4">
                    <button type="button" id="cancelEdit" class="w-full justify-center py-2 px-4 border rounded-md shadow-sm text-sm" style="border-color: var(--input-border); color: var(--text-primary); background-color: var(--btn-bg);">Cancelar</button>
                    <button type="submit" class="w-full justify-center py-2 px-4 border-transparent rounded-md shadow-sm text-sm text-white bg-blue-600 hover:bg-blue-700">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center hidden z-50">
        <div class="glass-effect p-8 rounded-lg shadow-2xl w-full max-w-md text-center">
            <h2 class="text-2xl font-semibold mb-5 text-yellow-400 font-orbitron">Confirmar Exclusão</h2>
            <p class="mb-6">Tem certeza de que deseja apagar este chamado? Esta ação não pode ser desfeita.</p>
            <div class="flex gap-4 pt-4">
                <button type="button" id="cancelDelete" class="w-full justify-center py-2 px-4 border rounded-md shadow-sm text-sm" style="border-color: var(--input-border); color: var(--text-primary); background-color: var(--btn-bg);">Cancelar</button>
                <button type="button" id="confirmDelete" class="w-full justify-center py-2 px-4 border-transparent rounded-md shadow-sm text-sm text-white bg-red-600 hover:bg-red-700">Apagar</button>
            </div>
        </div>
    </div>

    <div id="logoutModal" class="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center hidden z-50">
        <div class="glass-effect p-8 rounded-lg shadow-2xl w-full max-w-md text-center">
            <h2 class="text-2xl font-semibold mb-5 font-orbitron">Sair do Sistema</h2>
            <p class="mb-6">Tem certeza de que deseja sair?</p>
            <div class="flex gap-4 pt-4">
                <button type="button" id="cancelLogout" class="w-full justify-center py-2 px-4 border rounded-md shadow-sm text-sm" style="border-color: var(--input-border); color: var(--text-primary); background-color: var(--btn-bg);">Cancelar</button>
                <button type="button" id="confirmLogout" class="w-full justify-center py-2 px-4 border-transparent rounded-md shadow-sm text-sm text-white bg-red-600 hover:bg-red-700">Sair</button>
            </div>
        </div>
    </div>
    
    <script type="module">
        // --- DADOS DE DEMONSTRAÇÃO ---
        let mockChamados = [
            { id: 1, codigoChamado: 'LUMI-AGD43S', codigoCliente: 'CLI-001', nomeCliente: 'João da Silva', telefone: '11987654321', email: 'joao.silva@example.com', tipo: 'Suporte Técnico', descricao: 'O sistema está apresentando lentidão ao gerar relatórios de vendas.', dataAbertura: '2025-09-28T14:00:00Z', status: 'Em Andamento' },
            { id: 2, codigoChamado: 'LUMI-B7S8F9', codigoCliente: 'CLI-002', nomeCliente: 'Maria Oliveira', telefone: '21912345678', email: 'maria.o@example.com', tipo: 'Financeiro', descricao: 'Não recebi a fatura deste mês. Poderiam reenviar?', dataAbertura: '2025-09-29T10:30:00Z', status: 'Pendente' },
            { id: 3, codigoChamado: 'LUMI-C1A2B3', codigoCliente: 'CLI-003', nomeCliente: 'Pedro Martins', telefone: '83988887777', email: 'pedro.m@example.com', tipo: 'Vendas', descricao: 'Gostaria de solicitar uma demonstração do novo módulo de CRM.', dataAbertura: '2025-09-25T11:00:00Z', status: 'Resolvido' }
        ];
        let nextChamadoId = 4;
        
        // --- API SIMULADA ---
        const api = { 
            getChamados: async () => ({ list: [...mockChamados] }),
            postChamado: async (data) => {
                const newChamado = { ...data, id: nextChamadoId++ };
                mockChamados.push(newChamado);
                return newChamado;
            },
            patchChamado: async (id, data) => {
                const index = mockChamados.findIndex(c => c.id === id);
                if (index > -1) {
                    mockChamados[index] = { ...mockChamados[index], ...data };
                    return mockChamados[index];
                }
                throw new Error("Chamado não encontrado.");
            },
            deleteChamado: async (id) => {
                mockChamados = mockChamados.filter(c => c.id !== id);
                return { success: true };
            }
        };

        // --- ESTADO DA APLICAÇÃO ---
        let allChamados = [];

        // --- SELETORES DE UI ---
        const themeToggleBtn = document.getElementById('themeToggleBtn');
        const sunIcon = document.getElementById('theme-icon-sun'), moonIcon = document.getElementById('theme-icon-moon');
        const addChamadoBtn = document.getElementById('addChamadoBtn');
        const addEditModal = document.getElementById('addEditModal'), modalTitle = document.getElementById('modalTitle'), addEditForm = document.getElementById('addEditForm'), cancelEdit = document.getElementById('cancelEdit');
        const deleteModal = document.getElementById('deleteModal'), cancelDelete = document.getElementById('cancelDelete'), confirmDelete = document.getElementById('confirmDelete');
        const chamadosList = document.getElementById('chamadosList');
        const searchChamadoInput = document.getElementById('searchChamadoInput'), filterTipo = document.getElementById('filterTipo'), filterStatus = document.getElementById('filterStatus');
        const loginPage = document.getElementById('loginPage'), appWrapper = document.getElementById('app-wrapper'), loginForm = document.getElementById('loginForm'), logoutBtn = document.getElementById('logoutBtn');
        const logoutModal = document.getElementById('logoutModal'), cancelLogout = document.getElementById('cancelLogout'), confirmLogout = document.getElementById('confirmLogout');

        // --- FUNÇÕES UTILITÁRIAS ---
        const getStatusInfo = (status) => {
            switch (status) {
                case 'Resolvido': return { text: 'Resolvido', class: 'status-resolvido' };
                case 'Em Andamento': return { text: 'Em Andamento', class: 'status-andamento' };
                case 'Pendente':
                default:
                    return { text: 'Pendente', class: 'status-pendente' };
            }
        };
        const generateChamadoCode = () => `LUMI-${Math.random().toString(36).substring(2, 8).toUpperCase()}`;

        // --- LÓGICA DE RENDERIZAÇÃO ---
        const renderChamadosView = (chamados) => {
            chamadosList.innerHTML = chamados.length ? chamados.map(c => {
                const statusInfo = getStatusInfo(c.status);
                return `
                <tr class="border-b" style="border-color: var(--border-color);">
                    <td class="px-4 py-3 text-sm font-mono">${c.codigoChamado}</td>
                    <td class="px-4 py-3 text-sm">
                        <div class="font-medium">${c.nomeCliente}</div>
                        <div class="text-xs text-gray-400">${c.email || c.telefone}</div>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-400">${c.tipo}</td>
                    <td class="px-4 py-3 text-sm text-gray-400">${new Date(c.dataAbertura).toLocaleDateString('pt-BR')}</td>
                    <td class="px-4 py-3 text-sm text-center">
                        <span class="status-badge ${statusInfo.class}">
                            <span class="status-dot" style="background-color: currentColor;"></span>${statusInfo.text}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-center">
                        <div class="flex items-center justify-center gap-2">
                             <select class="custom-select text-xs status-changer" data-id="${c.id}" style="padding: 4px 8px; width: auto;">
                                <option value="Pendente" ${c.status === 'Pendente' ? 'selected' : ''}>Pendente</option>
                                <option value="Em Andamento" ${c.status === 'Em Andamento' ? 'selected' : ''}>Em Andamento</option>
                                <option value="Resolvido" ${c.status === 'Resolvido' ? 'selected' : ''}>Resolvido</option>
                            </select>
                            <button class="action-btn edit-btn" data-item='${JSON.stringify(c)}' title="Editar">
                                <svg class="pointer-events-none text-blue-400" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16"><path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V12h2.293z"/></svg>
                            </button>
                            <button class="action-btn delete-btn" data-id="${c.id}" title="Apagar">
                                <svg class="pointer-events-none text-red-400" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/><path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/></svg>
                            </button>
                        </div>
                    </td>
                </tr>
            `;}).join('') : `<tr><td colspan="6" class="p-4 text-center">Nenhum chamado encontrado.</td></tr>`;
        };
        
        const applyFiltersAndRender = () => {
            let filteredChamados = [...allChamados];
            const searchTerm = searchChamadoInput.value.toLowerCase();
            const tipoFilter = filterTipo.value;
            const statusFilter = filterStatus.value;

            if (searchTerm) {
                filteredChamados = filteredChamados.filter(c => c.nomeCliente.toLowerCase().includes(searchTerm));
            }
            if (tipoFilter !== 'todos') {
                filteredChamados = filteredChamados.filter(c => c.tipo === tipoFilter);
            }
            if (statusFilter !== 'todos') {
                filteredChamados = filteredChamados.filter(c => c.status === statusFilter);
            }
            
            renderChamadosView(filteredChamados.sort((a,b) => new Date(b.dataAbertura) - new Date(a.dataAbertura)));
        };
        
        const loadData = async () => {
            try {
                const chamados = await api.getChamados();
                allChamados = chamados.list || [];
                applyFiltersAndRender();
            } catch (error) {
                console.error("Erro ao carregar dados:", error);
            }
        };
        
        // --- EVENT LISTENERS ---
        addChamadoBtn.addEventListener('click', () => {
            modalTitle.textContent = "Abrir Novo Chamado";
            addEditForm.reset();
            addEditForm['edit-id'].value = '';
            addEditModal.classList.remove('hidden');
        });

        chamadosList.addEventListener('click', (e) => {
            const btn = e.target.closest('button.action-btn');
            if (!btn) return;
            const id = parseInt(btn.dataset.id);

            if (btn.classList.contains('delete-btn')) {
                confirmDelete.dataset.id = id;
                deleteModal.classList.remove('hidden');
            } else if (btn.classList.contains('edit-btn')) {
                modalTitle.textContent = "Editar Chamado";
                const item = JSON.parse(btn.dataset.item);
                addEditForm.elements['edit-id'].value = item.id;
                addEditForm.elements['edit-codigoCliente'].value = item.codigoCliente;
                addEditForm.elements['edit-nomeCliente'].value = item.nomeCliente;
                addEditForm.elements['edit-telefone'].value = item.telefone;
                addEditForm.elements['edit-email'].value = item.email;
                addEditForm.elements['edit-tipo'].value = item.tipo;
                addEditForm.elements['edit-descricao'].value = item.descricao;
                addEditModal.classList.remove('hidden');
            }
        });

        chamadosList.addEventListener('change', async (e) => {
            if (e.target.classList.contains('status-changer')) {
                const id = parseInt(e.target.dataset.id);
                const newStatus = e.target.value;
                try {
                    await api.patchChamado(id, { status: newStatus });
                    await loadData();
                } catch (error) {
                    console.error("Erro ao atualizar status:", error);
                }
            }
        });
        
        addEditForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = addEditForm['edit-id'].value ? parseInt(addEditForm['edit-id'].value) : null;
            const data = {
                codigoCliente: addEditForm['edit-codigoCliente'].value,
                nomeCliente: addEditForm['edit-nomeCliente'].value,
                telefone: addEditForm['edit-telefone'].value,
                email: addEditForm['edit-email'].value,
                tipo: addEditForm['edit-tipo'].value,
                descricao: addEditForm['edit-descricao'].value,
            };
            try {
                if (id) {
                    await api.patchChamado(id, data);
                } else {
                    data.codigoChamado = generateChamadoCode();
                    data.dataAbertura = new Date().toISOString();
                    data.status = 'Pendente';
                    await api.postChamado(data);
                }
                addEditModal.classList.add('hidden');
                await loadData();
            } catch (error) {
                console.error("Erro ao salvar chamado:", error);
            }
        });
        
        confirmDelete.addEventListener('click', async (e) => {
            const id = parseInt(e.currentTarget.dataset.id);
            try {
                await api.deleteChamado(id);
                deleteModal.classList.add('hidden');
                await loadData();
            } catch (error) {
                console.error("Erro ao apagar chamado:", error);
            }
        });
        
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            if (user === 'admin' && pass === 'lumi10') {
                loginPage.classList.add('hidden');
                appWrapper.classList.remove('hidden');
            } else {
                alert('Usuário ou senha inválidos!');
            }
        });

        logoutBtn.addEventListener('click', () => logoutModal.classList.remove('hidden'));
        cancelLogout.addEventListener('click', () => logoutModal.classList.add('hidden'));
        confirmLogout.addEventListener('click', () => {
            logoutModal.classList.add('hidden');
            appWrapper.classList.add('hidden');
            loginPage.classList.remove('hidden');
            loginForm.reset();
        });
        
        // --- INICIALIZAÇÃO ---
        [searchChamadoInput, filterTipo, filterStatus].forEach(el => el.addEventListener('input', applyFiltersAndRender));
        cancelEdit.addEventListener('click', () => addEditModal.classList.add('hidden'));
        cancelDelete.addEventListener('click', () => deleteModal.classList.add('hidden'));
        
        const applyTheme = (theme) => {
            document.documentElement.classList.toggle('light-theme', theme === 'light');
            document.documentElement.classList.toggle('dark-theme', theme === 'dark');
            sunIcon.classList.toggle('hidden', theme === 'dark');
            moonIcon.classList.toggle('hidden', theme === 'light');
            localStorage.setItem('theme', theme);
        };
        themeToggleBtn.addEventListener('click', () => applyTheme(localStorage.getItem('theme') === 'dark' ? 'light' : 'dark'));
        
        applyTheme(localStorage.getItem('theme') || 'dark');
        loadData();
    </script>
</body>
</html>